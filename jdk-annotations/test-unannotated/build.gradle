plugins {
    id "java-library"
}

dependencies {
    compileOnly deps.apt.autoService
    annotationProcessor deps.apt.autoService
    compileOnly project(":nullaway")
    api deps.build.jspecify
    implementation project(":jdk-annotations:test-annotated")
}

def astubxPath = "${rootProject.projectDir}/jdk-annotations/test-annotated/build/generated/astubx"

jar {
    manifest {
        attributes(
                'Created-By'     : "Gradle ${gradle.gradleVersion}",
                'Build-Jdk'      : "${System.properties['java.version']} (${System.properties['java.vendor']} ${System.properties['java.vm.version']})",
                'Build-OS'       : "${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}"
        )
    }
}

jar.doLast {
    exec {
        workingDir "${buildDir}"
        commandLine "jar", "uf", jar.archiveFile.get(), "-C", file(astubxPath), "."
    }
}